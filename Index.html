<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Carte Barsik - Niveaux Membres</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha512-PSykfrU/CiwfLUZUzZRH2W3n+scp3BvltzPLb1CE/HR8n0ivqrOAOOm1zhQ3XUQZ+sL0/00WdK2lwXQoNaCd2pg==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" integrity="sha512-fExSQiKzQ7SjGirYLZc12SlQ9Vertexr45urI39xNx0+Qq8yM8hP0tP3fb3iCEjHVeAeo4A0+tK5+QZktG5M8Gg==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" integrity="sha512-fQufNiXjCSReevGeTKxVYLUkFBp3D0YfWDAkBTwNXi8L82GQRSsSpo7aS7V3e9V1P/4CkLNSCQ5ueMGWuL+HdKA==" crossorigin="anonymous" />
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #map {
            height: 100%;
            width: 100%;
        }
        .leaflet-popup-content-wrapper {
            background: linear-gradient(135deg, #fffacd, #ffcccc);
            color: #333;
            font-family: "Comic Sans MS", Arial, sans-serif;
            font-size: 16px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border: 3px solid #ccffcc;
            padding: 5px;
        }
        .leaflet-popup-tip {
            background: #fffacd;
            border-left: 3px solid #ccffcc;
            border-right: 3px solid #ccffcc;
        }
        .marker-cluster-small {
            background-color: rgba(255, 250, 205, 0.8);
            border: 3px solid #ccffcc;
        }
        .marker-cluster-small div {
            background-color: #fffacd;
            color: #333;
            font-weight: bold;
            border-radius: 50%;
            font-family: "Comic Sans MS", Arial, sans-serif;
            font-size: 16px;
            line-height: 40px;
        }
        .marker-cluster-medium {
            background-color: rgba(255, 204, 204, 0.8);
            border: 3px solid #ccffcc;
        }
        .marker-cluster-medium div {
            background-color: #ffcccc;
            color: #333;
            border-radius: 50%;
            font-family: "Comic Sans MS", Arial, sans-serif;
            font-size: 18px;
            line-height: 50px;
        }
        .marker-cluster-large {
            background-color: rgba(204, 255, 204, 0.8);
            border: 3px solid #ccffcc;
        }
        .marker-cluster-large div {
            background-color: #ccffcc;
            color: #333;
            border-radius: 50%;
            font-family: "Comic Sans MS", Arial, sans-serif;
            font-size: 20px;
            line-height: 60px;
        }
        .barsik-coin {
            animation: bounce 1.5s infinite;
            -webkit-animation: bounce 1.5s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-15px) scale(1.2); }
            60% { transform: translateY(-7px) scale(1.1); }
        }
        @-webkit-keyframes bounce {
            0%, 20%, 50%, 80%, 100% { -webkit-transform: translateY(0) scale(1); }
            40% { -webkit-transform: translateY(-15px) scale(1.2); }
            60% { -webkit-transform: translateY(-7px) scale(1.1); }
        }
        .legend {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #333;
            font-family: "Comic Sans MS", Arial, sans-serif;
            font-size: 14px;
            line-height: 1.5;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            border-radius: 50%;
            border: 2px solid #333;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha512-Dq4zL+fdqQ4kbNr5BMMaFG6B7usMhuJ9L/h/iJ+fxceeBWkTJjsNveWs0mA5CrvB Sinclair3k6W8e8nY8Xg5t5Q==" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js" integrity="sha512-5QgbmG3rZYm0Q+zS8Uh0YebxaT7V0T+8vxsAg3R3+z+QXxlO9TfQNmMNDp5pTzO+UOwJMc+r8qSrt6pHOKCuXLA==" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof L === 'undefined') {
                document.getElementById('map').innerHTML = '<p>Erreur : Leaflet n\'a pas √©t√© charg√©. V√©rifiez votre connexion ou contactez le support.</p>';
                console.error('Leaflet n\'a pas √©t√© charg√©.');
                return;
            }

            var map = L.map('map', {
                zoomControl: true,
                doubleClickZoom: false,
                minZoom: 2,
                maxZoom: 17,
                renderer: L.canvas()
            }).setView([0, 0], 2);

            L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: '¬© <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',
                maxZoom: 17,
                errorTileUrl: ''
            }).addTo(map);

            var markers = L.markerClusterGroup({
                maxClusterRadius: 30,
                disableClusteringAtZoom: 15,
                iconCreateFunction: function(cluster) {
                    var childCount = cluster.getChildCount();
                    var size = childCount < 10 ? 40 : childCount < 50 ? 50 : 60;
                    return L.divIcon({
                        html: '<div><span>' + childCount + '</span></div>',
                        className: 'marker-cluster',
                        iconSize: [size, size]
                    });
                }
            });

            var membres = [
                { lat: 43.552849, lon: 7.017369, nom: "Lucien - Cannes", niveau: 1 },
                { lat: 42.59, lon: 47.29, nom: "DKHSTT - Makhachkala", niveau: 2 },
                { lat: 52.520007, lon: 13.404954, nom: "Hasbullish - Berlin", niveau: 1 },
                { lat: 44.4167, lon: 8.95, nom: "Fantasia - Genova", niveau: 1 },
                { lat: 26.739880, lon: 83.886971, nom: "The Crypto # - Kushinagar", niveau: 1 },
                { lat: 5.975, lon: 116.073, nom: "MSM - Kota Kinabalu", niveau: 1 },
                { lat: 47.762778, lon: 8.84, nom: "Dembigmoney - Singen Hohentwiel", niveau: 1 },
                { lat: 50.370, lon: 30.210, nom: "Rob - Bucha", niveau: 1 },
                { lat: 51.5074, lon: -0.1278, nom: "CryptoKnight - London", niveau: 1 },
                { lat: 55.7558, lon: 37.6173, nom: "Bobby - Moscou", niveau: 1 }
            ];

            function getColorAndRole(niveau) {
                switch (niveau) {
                    case 1: return { color: '#ffff00', role: 'Mods' };
                    case 2: return { color: '#ff0000', role: 'Team' };
                    case 3: return { color: '#00ff00', role: 'Community' };
                    default: return { color: '#ffff00', role: 'Mods' };
                }
            }

            membres.forEach(function(membre) {
                var { color, role } = getColorAndRole(membre.niveau);
                var barsikIcon = L.divIcon({
                    html: `<div style="background-color: ${color}; width: 32px; height: 32px; border-radius: 50%; border: 4px solid #333; box-shadow: 0 0 10px rgba(0,0,0,0.5), inset 0 0 5px #fff; transform: scale(1);" class="barsik-coin"></div>`,
                    className: '',
                    iconSize: [32, 32],
                    iconAnchor: [16, 16],
                    popupAnchor: [0, -16]
                });

                var marker = L.marker([membre.lat, membre.lon], { icon: barsikIcon })
                    .bindPopup(`${membre.nom} (${role})`);
                markers.addLayer(marker);
            });

            map.addLayer(markers);

            var titleControl = L.control({ position: 'topleft' });
            titleControl.onAdd = function(map) {
                var div = L.DomUtil.create('div', 'title');
                div.innerHTML = `
                    <div style="background: linear-gradient(135deg, #fffacd, #ffcccc); padding: 10px; border-radius: 12px; border: 4px solid #ccffcc; font-family: 'Comic Sans MS', Arial, sans-serif; font-size: 22px; color: #333; box-shadow: 0 4px 12px rgba(0,0,0,0.3); text-align: center;">
                        Barsik Community üêæ
                    </div>`;
                return div;
            };
            titleControl.addTo(map);

            var legend = L.control({ position: 'bottomright' });
            legend.onAdd = function(map) {
                var div = L.DomUtil.create('div', 'legend');
                div.innerHTML = `
                    <div><i style="background: #ff0000"></i> Team</div>
                    <div><i style="background: #ffff00"></i> Mods</div>
                    <div><i style="background: #00ff00"></i> Community</div>
                `;
                return div;
            };
            legend.addTo(map);
        });
    </script>
</body>
</html>
